# 可观测性（Observability）

随着微服务和云原生开发的兴起，越来越多应用基于分布式进行开发，但是大型应用拆分为微服务后，服务之间的依赖和调用变得越来越复杂，这些服务是不同团队、使用不同语言开发的，部署在不同机器上，他们之间提供的接口可能不同(gRPC、Restful api等)。为了维护这些服务，软件领域出现了 **Observability** 思想，在这个思想中，对微服务的维护分为三个部分：

- Tracing（链路追踪）：记录单个请求的处理流程，其中包括服务调用和处理时长等信息。
- Logging（日志记录）：用于记录离散的日志事件，包含程序执行到某一点或某一阶段的详细信息。
  - **是什么** 应用程序会输出稳定的日志消息流，以描述自身在何时做了什么。这些日志消息会捕获系统中发生的各种事件，例如失败或成功的操作、审计信息或运行状况。日志记录工具将收集、存储和分析这些消息，以追溯错误报告和相关数据。日志记录（loging）、度量（metrics)、追踪（tracing) 是可观察性的三大支柱。
  - **解决的问题** 收集、存储和分析日志是构建现代平台的关键部分，日志记录可帮助执行这其中的某一项或全部任务。一些工具可处理从收集到分析全方位的工作，还有一些工具则专注于单个任务（例如收集）。所有日志记录工具都旨在帮助组织更好地控制日志消息。
  - **如何解决** 在收集、存储和分析应用程序的日志消息时，我们将了解应用程序在任何给定时间的通信内容。但请注意，日志代表应用程序有意输出的消息，它们不一定能查明给定问题的根本原因。尽管如此，随时收集和保留日志消息是一项非常强大的功能，它将帮助团队诊断问题并满足合规性要求。
  - **常用工具** 尽管收集、存储和处理日志消息不是什么新鲜事，但云原生模式和 Kubernetes 的出现极大地改变了我们处理日志的方式。适用于虚拟机和物理机的传统日志记录方法（例如将日志写入文件）不适用于容器化的应用程序，因为在这些容器化应用程序中，文件系统的生命周期可能并不会比应用程序持久。在云原生环境中，诸如 Fluentd 之类的日志收集工具与应用程序容器一起运行，并直接从应用程序收集消息，然后将消息转发到中央日志存储以进行汇总和分析。 CNCF 中的日志记录工具只有 Fluentd。
- Metrics（指标）：可聚合的数据，通常是固定类型的时序数据，包括Counter、Gauge、Histogram等。
  比如Prometheus有4大指标类型（Metrics Type），分别是Counter（计数器）、Gauge（仪表盘）、Histogram（直方图）和Summary（摘要）。

这三部分并不是独立开来的，定义相交(或者说混合出现)的情况也比较常见。
详情戳：https://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html

![Annotated Venn diagram](https://peter.bourgon.org/img/instrumentation/01.png)

- Tracing & Logging：请求阶段的标签数据。例如在 Tracing 的信息中标记详情的错误原因。
- Tracing & Metrics：单个请求中的可计量数据。例如某 SQL 执行总时长、gRPC 调用总次数等。
- Logging & Metrics：可聚合的事件。例如分析某对象存储的Nginx日志，统计某段时间内GET、PUT、DELETE、OPTIONS操作的总数。
